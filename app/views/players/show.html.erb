<main class="container">
  <%= render_breadcrumbs %>

  <div style="display: flex; gap: 1rem; margin-bottom: 30px;">
    <% if @player.image %>
      <%= image_tag @player.image, style: "margin-top: 0.5rem; border-radius: 50%;" %>
    <% end %>

    <hgroup>
      <h2><%= @player.name %></h2>
      <h3>
        Has played <%= @player.match_count %> matches</br>
        Last played <%= @player.last_match_date && local_time_ago(@player.last_match_date) %>
      </h3>
    </hgroup>
  </div>

  <% if @player == current_player || current_player&.admin? %>
    <dl>
      <div>
        <dt><strong>Secure token:</strong></dt>
        <dd><span style="font-family: monospace;"><%= @player.auth_token %></span></dd>
      </div>
    </dl>
  <% end %>

  <table id="player_table" style="white-space: nowrap; max-width: 200px;" role="grid">
    <thead>
      <tr>
        <td>Played</td>
        <td>Wins</td>
        <td>Losses</td>
        <td>Draws</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><%= @player.match_count %></td>
        <td><%= @player.win_count %></td>
        <td><%= @player.loss_count %></td>
        <td><%= @player.draw_count %></td>
      </tr>
    </tbody>
  </table>


  <figure>
    <table id="player_discord_channels_table" style="white-space: nowrap;" role="grid">
      <thead>
        <tr>
          <th>Discord Channel</th>
          <% if @player.public_ratings || @player == current_player || current_player&.admin?  %>
            <th>Tier</th>
            <th data-sort-method='dotsep'>Percentile</th>
            <th data-sort-method='number'>Rank</th>
          <% end %>
          <th data-sort-method='number'>Played</th>
          <th data-sort-method='number'>Wins</th>
          <th data-sort-method='number'>Losses</th>
          <th data-sort-method='number'>Draws</th>
        </tr>
      </thead>
      <tbody>
        <% @player.discord_channel_players_with_matches_played.each do |dcp| %>
          <tr>
            <td><%= link_to dcp.discord_channel.name, results_discord_channel_path(dcp.discord_channel) %></td>
            <% if @player.public_ratings || @player == current_player  || current_player&.admin? %>
              <td><%= dcp.tier %></td>
              <td><%= dcp.percentile.to_i.ordinalize %></td>
              <td><%= dcp.rank %>/<%= dcp.discord_channel.players_with_at_least_one_match_played_count %></td>
            <% end %>
            <td><%= dcp.match_count %></td>
            <td><%= dcp.win_count %></td>
            <td><%= dcp.loss_count %></td>
            <td><%= dcp.draw_count %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </figure>
</main>
